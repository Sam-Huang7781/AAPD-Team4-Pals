<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <title>homepage</title>
</head>

<body>
  <%- include('./layout/header'); -%>

    <section class="meditate-count bg-primary-dark position-relative">
      <!-- meditate-count 冥想倒數頁 倒數透明遮罩 -->
      <section class="d-none position-absolute w-100 h-100 z-2 d-flex justify-content-center align-items-center"
        style="background: rgba(60, 60, 60, 0.8); transition: opacity 1s ease, visibility 0s 1s;"
        id="countdown-overlay">
        <h2 class="text-white mb-40" id="countdown-number" style="font-size: 128px">3</h2>
      </section>

      <!-- meditate-programming 冥想進行頁 -->
      <div class="container pb-16">
        <div class="ui-top d-flex align-items-center justify-content-center gap-12 py-10">
          <img src="/assets/images/meditateCount/Close_48.png" alt="close icon" />
          <h3 class="fs-5 text-white">正念冥想</h3>
          <img src="/assets/images/meditateCount/voice_48.png" alt="voice icon" />
        </div>

        <h4 class="meditate-instruction fs-5 text-white text-center">深吸氣，吐氣</h4>

        <div class="meditate-progress d-flex justify-content-center py-8 mb-3 position-relative">
          <div id="progress-circle" style="width: 288px"></div>
          <!-- <img src="/assets/images/meditateCount/dolls-meditiating_Y.png"
            class="position-absolute top-50 start-50 translate-middle object-fit-none" alt="dolls_meditiating_Y" /> -->
          <img src="/assets/images/meditateCount/dolls-meditiating_Y.svg"
            class="position-absolute top-50 start-50 translate-middle z-1" alt="dolls_meditiating_Y">
          <img src="/assets/images/meditateCount/aurora.png" class="position-absolute top-50 start-50 translate-middle"
            alt="aurora">
        </div>

        <div class="text-text-tertiary text-center">
          <h4 class="fs-5">您已經冥想了</h4>
          <time datetime="00:00" class="d-block fs-10 fw-bold mx-6 my-2" id="countDown"
            style="letter-spacing: 4.8px">00:00</time>
        </div>

        <div class="ui-bottom d-flex align-items-center justify-content-center gap-12 py-3">
          <button type="button" class="btn btn-transparent">
            <img src="/assets/images/meditateCount/back.svg" alt="backward icon" />
          </button>
          <button type="button" class="btn btn-transparent" id="start-meditation">
            <img src="/assets/images/meditateCount/PlayButton_80.png" alt="play icon" class="play-icon" />
            <img src="/assets/images/meditateCount/StopButton_80.png" alt="pause icon" class="pause-icon d-none" />
          </button>
          <button type="button" class="btn btn-transparent">
            <img src="/assets/images/meditateCount/forth.svg" alt="forward icon" />
          </button>
        </div>
      </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script type="module" src="../main.js"></script>
    <script type="module">
      import ProgressBar from 'progressbar.js/dist/progressbar.min.js';

      var bar = new ProgressBar.Circle("#progress-circle", {
        strokeWidth: 4,
        easing: "easeInOut",
        duration: 1400,
        color: "#ffcc00",
        trailColor: "#eee",
        trailWidth: 4,
        svgStyle: null,
      });

      // 更新進度
      bar.set(0);

      document
        .getElementById("start-meditation")
        .addEventListener("click", function () {
          var startMeditation = document.querySelector('#start-meditation');
          var countdownOverlay = document.getElementById("countdown-overlay");
          var countdownNumber = document.getElementById("countdown-number");
          var meditateInstruction = document.getElementById("meditate-instruction");
          var countDown = document.getElementById("countDown");
          var count = 3;

          // 更換 icon
          startMeditation
            .querySelector('.play-icon')
            .classList.add('d-none');
          startMeditation
            .querySelector('.pause-icon')
            .classList.remove('d-none');

          // 立即更新倒數數字並顯示倒數頁
          countdownNumber.textContent = count;
          countdownOverlay.classList.remove("d-none");
          countdownOverlay.style.opacity = "1";
          countdownOverlay.style.visibility = "visible";

          // 每秒減少倒數
          var countdownInterval = setInterval(function () {
            count--;
            countdownNumber.textContent = count;

            if (count === 0) {
              clearInterval(countdownInterval);

              // 倒數結束，開始淡出效果
              countdownOverlay.style.opacity = "0";

              setTimeout(function () {
                countdownOverlay.style.visibility = "hidden";
                countdownOverlay.classList.add("d-none"); // 確保過渡完成後再加入 d-none
              }, 1000); // 等待過渡效果完成 (1 秒)

              window.location.href = "./meditate-program.html";
              // 進入冥想進行頁
              // 這裡你可以觸發任何進行頁面的功能或效果
            }
          }, 1000); // 每1秒執行一次
        });
    </script>
</body>

</html>